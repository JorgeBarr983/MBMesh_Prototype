# MB-System mbmesh Prototype

A proof-of-concept implementation for converting seafloor mapping data (swath bathymetry) directly to 3D mesh files in glTF format for web browser visualization.

## Overview

This prototype demonstrates the core functionality proposed in [MB-System Issue #1559](https://github.com/dwcaress/MB-System/issues/1559): creating 3D mesh files directly from swath bathymetry data, bypassing traditional 2D gridding operations. This approach enables accurate representation of complex bathymetric features like cliffs, spires, overhangs, and caves.

## Features

- **Direct swath-to-mesh conversion**: Generates 3D meshes without intermediate gridding
- **glTF 2.0 output**: Industry-standard 3D format compatible with web browsers
- **Web visualization**: View results using X3DOM in any modern browser
- **Simulated bathymetry**: Demonstrates mesh generation with ridge and seamount features
- **Foundation for 3D Tiles**: Designed as a stepping stone to OGC 3D Tiles 1.1

## Files

- `mbmesh_prototype.cpp` - Main C++ program that generates glTF meshes
- `viewer.html` - Web-based 3D viewer using X3DOM
- `Makefile` - Build system for compiling the prototype
- `README.md` - This file

## Requirements

### Compilation
- C++ compiler with C++11 support (g++, clang++, etc.)
- Make (optional, for using Makefile)

### Viewing
- Modern web browser (Chrome, Firefox, Safari, Edge)
- Local web server (recommended for proper glTF loading)

## Quick Start

### 1. Compile the Program

```bash
make
```

Or compile manually:
```bash
g++ -std=c++11 -Wall -O2 -o mbmesh_prototype mbmesh_prototype.cpp
```

### 2. Generate the Mesh

```bash
./mbmesh_prototype
```

This creates:
- `seafloor_mesh.gltf` - glTF JSON file
- `seafloor_mesh.bin` - Binary buffer with vertex/index data

### 3. View the Results

Start a local web server in the directory:

```bash
# Python 3
python3 -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000

# Node.js (with npx)
npx http-server -p 8000
```

Then open your browser to: `http://localhost:8000/viewer.html`

## How It Works

### 1. Data Generation (Simulated)
The prototype generates simulated swath bathymetry data in a grid pattern:
- 50 beams across-track
- 100 pings along-track
- 10m point spacing
- Simulated features: sinusoidal ridge + Gaussian seamount

### 2. Mesh Creation
- Vertices are created from bathymetry points (X, Y, Z coordinates)
- Triangles are generated by connecting adjacent grid points
- Two triangles per grid cell form the mesh

### 3. glTF Export
The program writes:
- **JSON file** (`.gltf`): Scene structure, mesh metadata, accessors
- **Binary file** (`.bin`): Raw vertex positions and triangle indices

### 4. Web Visualization
The HTML viewer uses X3DOM to:
- Load and render the glTF file
- Provide interactive 3D controls (rotate, zoom, pan)
- Display coordinate axes for orientation

## Sample Output

```
MB-System mbmesh Prototype
==========================

Generating sample swath bathymetry data...
Generated 5000 bathymetry points

Creating 3D mesh from swath data...
Mesh created

Writing glTF file...
Files written: seafloor_mesh.gltf, seafloor_mesh.bin

Success! View the mesh by opening viewer.html in a web browser.
```

## Current Limitations

This is a simplified prototype. For production use, the following would be needed:

1. **Real Data Integration**
   - Read actual MB-System swath data formats
   - Use existing `mbgrid` code for datalist handling
   - Support multiple input file formats

2. **Advanced Features**
   - Draco compression (from `mbgrd2gltf` code)
   - Level-of-detail (LOD) mesh generation
   - Texture mapping for bathymetry visualization
   - Color gradients based on depth

3. **3D Tiles Support**
   - Hierarchical tiling structure
   - Spatial indexing
   - Dynamic LOD streaming
   - OGC 3D Tiles 1.1 compatibility

4. **Performance Optimization**
   - Efficient mesh simplification
   - Memory management for large datasets
   - Parallel processing

## Next Development Steps

1. **Integrate MB-System Libraries**
   - Link against MB-System libraries
   - Use mb_read functions for swath data
   - Handle datalist files

2. **Add Draco Compression**
   - Port code from `mbgrd2gltf`
   - Reduce file sizes by 10-20x

3. **Implement 3D Tiles**
   - Create tileset.json structure
   - Generate hierarchical tiles
   - Implement quadtree/octree spatial partitioning

4. **Enhanced Viewer**
   - Integrate with Cesium for full 3D Tiles support
   - Add bathymetry color mapping
   - Provide measurement tools

## Architecture

```
Input: Swath Bathymetry Data
          │
          ├─→ Read Points (X, Y, Z)
          │
          ├─→ Generate Mesh (Vertices + Triangles)
          │
          ├─→ Write glTF 2.0
          │       ├─→ JSON structure
          │       └─→ Binary buffers
          │
          └─→ Viewer (X3DOM/WebGL)
                  └─→ Interactive 3D visualization
```

## Resources

- **MB-System**: https://www.mbari.org/products/research-software/mb-system/
- **glTF Specification**: https://registry.khronos.org/glTF/specs/2.0/glTF-2.0.html
- **OGC 3D Tiles**: https://github.com/CesiumGS/3d-tiles
- **X3DOM**: https://www.x3dom.org/
- **Cesium Community**: https://community.cesium.com/

## License

This prototype is intended for development and demonstration purposes as part of the MB-System project.

## Contributing

This prototype supports development of the `mbmesh` program for MB-System. For questions or contributions, see [GitHub Issue #1559](https://github.com/dwcaress/MB-System/issues/1559).

## Contact

Project Mentor: See MB-System repository
Project Repository: https://github.com/dwcaress/MB-System
